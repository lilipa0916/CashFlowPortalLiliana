@page "/fondos"


@using CashFlowPortal.Applicacion.Interfaces.IServices

@inject IFondoMonetarioService Repo
@inject NavigationManager Nav
@inject IJSRuntime JSRuntime

<div class="container mt-4">
    <div class="d-flex justify-content-between align-items-center mb-3">
        <h2>Fondos Monetarios</h2>
        <NavLink class="btn btn-primary" href="fondos/crear">
            <i class="bi bi-plus-lg"></i> Nuevo Fondo
        </NavLink>
    </div>

    @if (fondos is null)
    {
        <div class="alert alert-info">Cargando...</div>
    }
    else if (!fondos.Any())
    {
        <div class="alert alert-warning">No hay fondos monetarios registrados.</div>
    }
    else
    {
        <table class="table table-striped table-hover">
            <thead class="table-dark">
                <tr>
                    <th>Nombre</th>
                    <th>Tipo</th>
                    <th>Saldo</th>
                    <th>Fecha Creación</th>
                    <th class="text-end">Acciones</th>
                </tr>
            </thead>
            <tbody>
                @foreach (var f in fondos)
                {
                    <tr>
                        <td>@f.Nombre</td>
                        <td>@f.Tipo</td>
                        <td>@f.Saldo.ToString("C")</td>
                        <td>@f.FechaCreacion.ToString("yyyy-MM-dd HH:mm")</td>
                        <td class="text-end">
                            <NavLink class="btn btn-sm btn-secondary me-1" href="fondos/editar/{f.Id}">
                                <i class="bi bi-pencil"></i>
                            </NavLink>
                            <button class="btn btn-sm btn-danger" @onclick="() => Eliminar(f.Id)">
                                <i class="bi bi-trash"></i>
                            </button>
                        </td>
                    </tr>
                }
            </tbody>
        </table>
    }
</div>

@code {
    private List<CashFlowPortal.Applicacion.DTOs.FondoMonetario.FondoMonetarioDto> fondos;

    protected override async Task OnInitializedAsync()
    {
        fondos = await Repo.GetAllAsync();
    }
    private void CrearNuevo() => Nav.NavigateTo("/fondosmonetario/create");

    private void Editar(int id) => Nav.NavigateTo($"/fondosmonetario/edit/{id}");

    private async Task Eliminar(int id)
    {
        if (await JsConfirm("¿Está seguro de eliminar este fondo?"))
        {
            await Repo.DeleteAsync(id);
            fondos = await Repo.GetAllAsync();
            StateHasChanged();
        }
    }

    private async Task<bool> JsConfirm(string mensaje)
    {
        return await JSRuntime.InvokeAsync<bool>("confirm", mensaje);
    }
}